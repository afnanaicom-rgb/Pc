<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Afnan AI - Ø±ÙˆÙ… Ø§Ù„ØµÙˆØª</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #8b5cf6;
            --accent: #f59e0b;
            --bg-black: #000000;
            --glass: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.15);
            --wealth: #facc15;
            --magic: #d946ef;
        }

        * { 
            box-sizing: border-box; 
            margin: 0; 
            padding: 0; 
            outline: none; 
            -webkit-tap-highlight-color: transparent; 
        }
        
        body {
            font-family: 'Cairo', sans-serif;
            background-color: var(--bg-black);
            color: #fff; 
            height: 100vh; 
            overflow: hidden;
        }

        .app-bg {
            position: fixed; 
            inset: 0;
            background: radial-gradient(circle at 10% 10%, #1e1b4b 0%, #000000 50%);
            z-index: -1;
        }

        .app-container { 
            width: 100%; 
            height: 100%; 
            display: flex; 
            flex-direction: column; 
            position: relative; 
        }

        /* Ø§Ù„Ù‡ÙŠØ¯Ø± */
        .header { 
            padding: 15px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            z-index: 100; 
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--glass-border);
        }
        
        .room-info {
            display: flex; 
            align-items: center; 
            gap: 10px; 
            background: var(--glass);
            padding: 5px 12px; 
            border-radius: 30px; 
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(15px); 
            cursor: pointer;
        }
        
        .owner-img { 
            width: 38px; 
            height: 38px; 
            border-radius: 50%; 
            border: 2px solid var(--accent); 
        }

        /* Ø´Ø¨ÙƒØ© Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†Ø§Øª */
        .mics-grid { 
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            padding: 20px;
            flex: 1;
            overflow-y: auto;
        }
        
        @media (min-width: 768px) {
            .mics-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        @media (min-width: 1024px) {
            .mics-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        .user-card {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: all 0.3s ease;
            position: relative;
        }

        .user-card.speaking {
            box-shadow: 0 0 20px rgba(34, 197, 94, 0.3);
            border-color: #22c55e;
        }

        .user-card.muted {
            opacity: 0.7;
            filter: grayscale(50%);
        }

        .user-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 3px solid var(--accent);
            margin-bottom: 10px;
            object-fit: cover;
        }

        .user-name {
            font-weight: bold;
            font-size: 14px;
            margin-bottom: 5px;
            text-align: center;
        }

        .user-levels {
            display: flex;
            gap: 5px;
            margin-bottom: 10px;
        }

        .level-badge {
            font-size: 10px;
            padding: 2px 8px;
            border-radius: 10px;
            font-weight: bold;
        }

        .level-wealth {
            background: var(--wealth);
            color: #000;
        }

        .level-magic {
            background: var(--magic);
            color: #fff;
        }

        .mic-indicator {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .mic-on {
            background: #22c55e;
            color: white;
        }

        .mic-off {
            background: #ef4444;
            color: white;
        }

        /* Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØ­ÙƒÙ… */
        .controls-bar {
            padding: 15px;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(20px);
            border-top: 1px solid var(--glass-border);
            display: flex;
            justify-content: space-around;
            align-items: center;
        }

        .control-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.2s ease;
            background: var(--glass);
            border: 1px solid var(--glass-border);
            color: white;
        }

        .control-btn:hover {
            transform: scale(1.05);
        }

        .control-btn:active {
            transform: scale(0.95);
        }

        .control-btn.mic {
            background: var(--primary);
        }

        .control-btn.leave {
            background: #ef4444;
        }

        .control-btn.settings {
            background: #6b7280;
        }

        /* Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø¯ÙˆØ§Øª */
        .tools-bar {
            padding: 10px 15px;
            display: flex;
            gap: 10px;
            overflow-x: auto;
            background: rgba(0, 0, 0, 0.5);
            border-bottom: 1px solid var(--glass-border);
        }

        .tool-btn {
            flex-shrink: 0;
            padding: 8px 15px;
            border-radius: 20px;
            border: 1px solid var(--glass-border);
            background: var(--glass);
            color: white;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .tool-btn:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        /* Ø§Ù„Ø´Ø§Øª */
        .chat-container {
            position: fixed;
            bottom: 140px;
            left: 15px;
            right: 15px;
            max-height: 300px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
        }

        .message {
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            padding: 10px;
            max-width: 80%;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.system {
            align-self: center;
            background: rgba(59, 130, 246, 0.3);
            border-color: #3b82f6;
        }

        .message.user {
            align-self: flex-end;
            background: rgba(139, 92, 246, 0.3);
            border-color: var(--primary);
        }

        .message.other {
            align-self: flex-start;
            background: rgba(75, 85, 99, 0.3);
        }

        .message-header {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-bottom: 5px;
        }

        .message-avatar {
            width: 20px;
            height: 20px;
            border-radius: 50%;
        }

        .message-username {
            font-weight: bold;
            font-size: 12px;
        }

        .message-content {
            font-size: 14px;
        }

        .message-time {
            font-size: 10px;
            color: #9ca3af;
            text-align: left;
            margin-top: 5px;
        }

        /* Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù†Øµ */
        .input-container {
            position: fixed;
            bottom: 80px;
            left: 15px;
            right: 15px;
            z-index: 1000;
        }

        .chat-input {
            width: 100%;
            padding: 12px 15px;
            border-radius: 25px;
            border: 1px solid var(--glass-border);
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            color: white;
            font-size: 14px;
        }

        .chat-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª */
        .notification {
            position: fixed;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            padding: 10px 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 2000;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        /* ØªØ­Ù…ÙŠÙ„ */
        .loading {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 3000;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 3px solid transparent;
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ù‡Ø¯Ø§ÙŠØ§ */
        .gift-effect {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 100px;
            z-index: 4000;
            pointer-events: none;
            animation: giftAnimation 2s ease-out forwards;
        }

        @keyframes giftAnimation {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0);
            }
            50% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1.5);
            }
            100% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(1) translateY(-100px);
            }
        }
    </style>
</head>
<body>

<div class="app-bg"></div>

<div class="app-container">
    <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø¯ÙˆØ§Øª -->
    <div class="tools-bar" id="toolsBar">
        <button class="tool-btn" onclick="toggleMuteAll()">
            <i class="fas fa-volume-mute"></i> ÙƒØªÙ… Ø§Ù„ÙƒÙ„
        </button>
        <button class="tool-btn" onclick="inviteFriends()">
            <i class="fas fa-user-plus"></i> Ø¯Ø¹ÙˆØ© Ø£ØµØ¯Ù‚Ø§Ø¡
        </button>
        <button class="tool-btn" onclick="openGifts()">
            <i class="fas fa-gift"></i> Ø§Ù„Ù‡Ø¯Ø§ÙŠØ§
        </button>
        <button class="tool-btn" onclick="openSettings()">
            <i class="fas fa-cog"></i> Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
        </button>
        <button class="tool-btn" onclick="showRoomInfo()">
            <i class="fas fa-info-circle"></i> Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø±ÙˆÙ…
        </button>
    </div>

    <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
    <header class="header">
        <div class="room-info" id="roomInfo">
            <div>
                <span style="font-size:9px; color:var(--accent)" id="roomId">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span>
                <div style="font-size:12px; font-weight:bold" id="roomName">Ø±ÙˆÙ… Ø§Ù„ØµÙˆØª</div>
            </div>
        </div>
        <div style="display:flex; gap:8px">
            <button class="control-btn" onclick="toggleFullscreen()">
                <i class="fa-solid fa-expand"></i>
            </button>
            <button class="control-btn leave" onclick="leaveRoom()">
                <i class="fa-solid fa-phone-slash"></i>
            </button>
        </div>
    </header>

    <!-- Ø´Ø¨ÙƒØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† -->
    <div class="mics-grid" id="micsGrid">
        <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡Ø§ Ø¨Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† -->
    </div>

    <!-- Ø§Ù„Ø´Ø§Øª -->
    <div class="chat-container" id="chatContainer"></div>

    <!-- Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø´Ø§Øª -->
    <div class="input-container">
        <input type="text" 
               class="chat-input" 
               id="chatInput" 
               placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©..." 
               onkeypress="handleChatInput(event)">
    </div>

    <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªØ­ÙƒÙ… -->
    <div class="controls-bar">
        <button class="control-btn mic" id="micBtn" onclick="toggleMic()">
            <i class="fas fa-microphone"></i>
        </button>
        <button class="control-btn" onclick="toggleCamera()">
            <i class="fas fa-video"></i>
        </button>
        <button class="control-btn" onclick="toggleChat()">
            <i class="fas fa-comment"></i>
        </button>
        <button class="control-btn settings" onclick="openAudioSettings()">
            <i class="fas fa-sliders-h"></i>
        </button>
    </div>
</div>

<!-- Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ -->
<div class="loading" id="loadingScreen">
    <div class="spinner"></div>
    <p style="margin-top: 20px; color: #9ca3af;">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø±ÙˆÙ…...</p>
</div>

<!-- Scripts -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
    // ØªÙ‡ÙŠØ¦Ø© Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyBnmqWRY6lV54meFvO89QeXwtd28w81FcY",
        authDomain: "rtx3090-28439.firebaseapp.com",
        projectId: "rtx3090-28439",
        storageBucket: "rtx3090-28439.firebasestorage.app",
        messagingSenderId: "178612030690",
        appId: "1:178612030690:web:883189ced2ed3a78e3e2bb",
        databaseURL: "https://rtx3090-28439-default-rtdb.firebaseio.com/"
    };
    
    const app = firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const rtdb = firebase.database();

    // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
    let currentUser = null;
    let currentUserData = null;
    let currentRoom = null;
    let roomData = null;
    let localStream = null;
    let peerConnections = {};
    let isMuted = false;
    let isChatVisible = true;
    let messagesListener = null;
    let roomListener = null;
    let signalsListener = null;

    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
    document.addEventListener('DOMContentLoaded', async () => {
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        auth.onAuthStateChanged(async (user) => {
            if (user) {
                currentUser = user;
                await loadUserData();
                await joinRoomFromURL();
            } else {
                window.location.href = 'afnan.html';
            }
        });
    });

    // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    async function loadUserData() {
        try {
            const userDoc = await db.collection('users').doc(currentUser.uid).get();
            if (userDoc.exists) {
                currentUserData = userDoc.data();
            }
        } catch (error) {
            console.error('Error loading user data:', error);
        }
    }

    // Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù„Ø±ÙˆÙ… Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø·
    async function joinRoomFromURL() {
        const urlParams = new URLSearchParams(window.location.search);
        const roomId = urlParams.get('id');
        
        if (!roomId) {
            showNotification('Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø±ÙˆÙ…', 'error');
            setTimeout(() => window.location.href = 'afnan.html', 2000);
            return;
        }

        try {
            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø±ÙˆÙ…
            const roomDoc = await db.collection('rooms').doc(roomId).get();
            
            if (!roomDoc.exists) {
                showNotification('Ø§Ù„Ø±ÙˆÙ… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
                setTimeout(() => window.location.href = 'afnan.html', 2000);
                return;
            }

            roomData = roomDoc.data();
            currentRoom = roomId;
            
            // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±ÙˆÙ…
            updateRoomUI();
            
            // Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù„Ø±ÙˆÙ…
            await joinRoom();
            
            // Ø¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
            document.getElementById('loadingScreen').style.display = 'none';
            
        } catch (error) {
            console.error('Error joining room:', error);
            showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù„Ø±ÙˆÙ…', 'error');
        }
    }

    // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±ÙˆÙ…
    function updateRoomUI() {
        if (!roomData) return;
        
        document.getElementById('roomName').textContent = roomData.name;
        document.getElementById('roomId').textContent = `ID: ${currentRoom}`;
        
        // ØªØ­Ø¯ÙŠØ« Ø´Ø¨ÙƒØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
        updateUsersGrid();
    }

    // ØªØ­Ø¯ÙŠØ« Ø´Ø¨ÙƒØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
    function updateUsersGrid() {
        if (!roomData || !roomData.users) return;
        
        const micsGrid = document.getElementById('micsGrid');
        micsGrid.innerHTML = '';
        
        roomData.users.forEach(user => {
            const isCurrentUser = user.uid === currentUser?.uid;
            const userCard = document.createElement('div');
            userCard.className = `user-card ${user.isMuted ? 'muted' : ''} ${isCurrentUser ? 'speaking' : ''}`;
            
            userCard.innerHTML = `
                <img src="${user.avatar}" class="user-avatar" alt="${user.name}">
                <div class="user-name">${user.name} ${user.isOwner ? 'ğŸ‘‘' : ''}</div>
                <div class="user-levels">
                    <span class="level-badge level-wealth">W.${user.wealthLevel || 1}</span>
                    <span class="level-badge level-magic">M.${user.magicLevel || 1}</span>
                </div>
                <div class="mic-indicator ${user.isMuted ? 'mic-off' : 'mic-on'}">
                    <i class="fas ${user.isMuted ? 'fa-microphone-slash' : 'fa-microphone'}"></i>
                </div>
            `;
            
            micsGrid.appendChild(userCard);
        });
    }

    // Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù„Ø±ÙˆÙ…
    async function joinRoom() {
        try {
            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†
            await getMediaPermissions();
            
            // ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø±ÙˆÙ…
            await updateRoomUsers();
            
            // Ø¨Ø¯Ø¡ Ø§Ø³ØªÙ…Ø§Ø¹ WebRTC
            await startWebRTC();
            
            // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„Ø±Ø³Ø§Ø¦Ù„
            listenToMessages();
            
            // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„Ø±ÙˆÙ…
            listenToRoomUpdates();
            
            // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨
            addSystemMessage(`Ø§Ù†Ø¶Ù… ${currentUserData?.displayName || 'Ù…Ø³ØªØ®Ø¯Ù…'} Ø¥Ù„Ù‰ Ø§Ù„Ø±ÙˆÙ…`);
            
        } catch (error) {
            console.error('Error in joinRoom:', error);
            throw error;
        }
    }

    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†
    async function getMediaPermissions() {
        try {
            localStream = await navigator.mediaDevices.getUserMedia({
                audio: {
                    echoCancellation: true,
                    noiseSuppression: true,
                    autoGainControl: true,
                    channelCount: 1
                },
                video: false
            });
            
            // ØªØ­Ø¯ÙŠØ« Ø²Ø± Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†
            updateMicButton();
            
        } catch (error) {
            console.error('Error getting media permissions:', error);
            showNotification('ÙŠØ¬Ø¨ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†', 'warning');
            throw error;
        }
    }

    // ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙÙŠ Ø§Ù„Ø±ÙˆÙ…
    async function updateRoomUsers() {
        if (!currentRoom || !currentUserData) return;
        
        const userInRoom = {
            uid: currentUser.uid,
            name: currentUserData.displayName,
            avatar: currentUserData.photoURL,
            isMuted: false,
            isSpeaker: true,
            joinedAt: new Date(),
            magicLevel: currentUserData.magicLevel || 1,
            wealthLevel: currentUserData.wealthLevel || 1,
            isOwner: roomData.ownerId === currentUser.uid
        };
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„
        const userExists = roomData.users?.some(u => u.uid === currentUser.uid);
        
        if (!userExists) {
            await db.collection('rooms').doc(currentRoom).update({
                users: firebase.firestore.FieldValue.arrayUnion(userInRoom),
                currentSpeakers: firebase.firestore.FieldValue.increment(1)
            });
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        await db.collection('users').doc(currentUser.uid).update({
            currentRoom: currentRoom
        });
    }

    // Ø¨Ø¯Ø¡ WebRTC
    async function startWebRTC() {
        // ØªÙƒÙˆÙŠÙ† ICE servers
        const rtcConfig = {
            iceServers: [
                { urls: 'stun:stun.l.google.com:19302' },
                { urls: 'stun:stun1.l.google.com:19302' },
                { urls: 'stun:stun2.l.google.com:19302' },
                { urls: 'stun:stun3.l.google.com:19302' },
                { urls: 'stun:stun4.l.google.com:19302' }
            ]
        };
        
        // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„Ø¥Ø´Ø§Ø±Ø§Øª
        listenForSignals();
        
        // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø§Ø±Ø© Ø¯Ø®ÙˆÙ„
        sendSignal('join', null);
    }

    // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ø¥Ø´Ø§Ø±Ø§Øª WebRTC
    function listenForSignals() {
        const signalsRef = rtdb.ref(`rooms/${currentRoom}/signals`);
        
        signalsListener = signalsRef.on('child_added', async (snapshot) => {
            const signal = snapshot.val();
            
            // ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ø¥Ø´Ø§Ø±Ø§Øª Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ
            if (signal.userId === currentUser.uid) return;
            
            try {
                if (signal.type === 'join') {
                    await handleUserJoin(signal.userId);
                } else if (signal.type === 'offer') {
                    await handleOffer(signal.userId, signal.offer);
                } else if (signal.type === 'answer') {
                    await handleAnswer(signal.userId, signal.answer);
                } else if (signal.type === 'ice-candidate') {
                    await handleIceCandidate(signal.userId, signal.candidate);
                } else if (signal.type === 'leave') {
                    await handleUserLeave(signal.userId);
                }
            } catch (error) {
                console.error('Error handling signal:', error);
            }
        });
    }

    // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¯Ø®ÙˆÙ„ Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯
    async function handleUserJoin(userId) {
        // Ø¥Ù†Ø´Ø§Ø¡ Ø§ØªØµØ§Ù„ Ø¬Ø¯ÙŠØ¯
        const pc = new RTCPeerConnection({
            iceServers: [
                { urls: 'stun:stun.l.google.com:19302' }
            ]
        });
        
        peerConnections[userId] = pc;
        
        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ù…Ø­Ù„ÙŠ
        localStream.getTracks().forEach(track => {
            pc.addTrack(track, localStream);
        });
        
        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ù…Ø±Ø´Ø­Ø§Øª ICE
        pc.onicecandidate = (event) => {
            if (event.candidate) {
                sendSignalToUser(userId, 'ice-candidate', event.candidate);
            }
        };
        
        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„ÙˆØ§Ø±Ø¯
        pc.ontrack = (event) => {
            const audioElement = document.createElement('audio');
            audioElement.id = `audio-${userId}`;
            audioElement.autoplay = true;
            audioElement.controls = false;
            audioElement.style.display = 'none';
            document.body.appendChild(audioElement);
            audioElement.srcObject = event.streams[0];
        };
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ø±Ø¶ Ø§ØªØµØ§Ù„
        const offer = await pc.createOffer();
        await pc.setLocalDescription(offer);
        
        sendSignalToUser(userId, 'offer', offer);
    }

    // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø§ØªØµØ§Ù„
    async function handleOffer(userId, offer) {
        const pc = new RTCPeerConnection({
            iceServers: [
                { urls: 'stun:stun.l.google.com:19302' }
            ]
        });
        
        peerConnections[userId] = pc;
        
        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ù…Ø­Ù„ÙŠ
        localStream.getTracks().forEach(track => {
            pc.addTrack(track, localStream);
        });
        
        pc.onicecandidate = (event) => {
            if (event.candidate) {
                sendSignalToUser(userId, 'ice-candidate', event.candidate);
            }
        };
        
        pc.ontrack = (event) => {
            const audioElement = document.createElement('audio');
            audioElement.id = `audio-${userId}`;
            audioElement.autoplay = true;
            audioElement.controls = false;
            audioElement.style.display = 'none';
            document.body.appendChild(audioElement);
            audioElement.srcObject = event.streams[0];
        };
        
        await pc.setRemoteDescription(new RTCSessionDescription(offer));
        
        const answer = await pc.createAnswer();
        await pc.setLocalDescription(answer);
        
        sendSignalToUser(userId, 'answer', answer);
    }

    // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©
    async function handleAnswer(userId, answer) {
        const pc = peerConnections[userId];
        if (pc) {
            await pc.setRemoteDescription(new RTCSessionDescription(answer));
        }
    }

    // Ù…Ø¹Ø§Ù„Ø¬Ø© Ù…Ø±Ø´Ø­ ICE
    async function handleIceCandidate(userId, candidate) {
        const pc = peerConnections[userId];
        if (pc) {
            await pc.addIceCandidate(new RTCIceCandidate(candidate));
        }
    }

    // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø®Ø±ÙˆØ¬ Ù…Ø³ØªØ®Ø¯Ù…
    async function handleUserLeave(userId) {
        // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø§ØªØµØ§Ù„
        if (peerConnections[userId]) {
            peerConnections[userId].close();
            delete peerConnections[userId];
        }
        
        // Ø¥Ø²Ø§Ù„Ø© Ø¹Ù†ØµØ± Ø§Ù„ØµÙˆØª
        const audioElement = document.getElementById(`audio-${userId}`);
        if (audioElement) {
            audioElement.remove();
        }
        
        // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ù†Ø¸Ø§Ù…
        addSystemMessage(`ØºØ§Ø¯Ø± Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Ø§Ù„Ø±ÙˆÙ…`);
    }

    // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø§Ø±Ø©
    function sendSignal(type, data) {
        if (!currentRoom || !currentUser) return;
        
        const signalRef = rtdb.ref(`rooms/${currentRoom}/signals`).push();
        signalRef.set({
            type: type,
            userId: currentUser.uid,
            data: data,
            timestamp: Date.now()
        });
    }

    // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø§Ø±Ø© Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø­Ø¯Ø¯
    function sendSignalToUser(targetUserId, type, data) {
        if (!currentRoom || !currentUser) return;
        
        const signalRef = rtdb.ref(`rooms/${currentRoom}/signals`).push();
        signalRef.set({
            type: type,
            userId: currentUser.uid,
            targetUserId: targetUserId,
            data: data,
            timestamp: Date.now()
        });
    }

    // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„Ø±ÙˆÙ…
    function listenToRoomUpdates() {
        roomListener = db.collection('rooms').doc(currentRoom)
            .onSnapshot((doc) => {
                if (doc.exists) {
                    roomData = doc.data();
                    updateUsersGrid();
                }
            });
    }

    // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„Ø±Ø³Ø§Ø¦Ù„
    function listenToMessages() {
        messagesListener = db.collection('rooms').doc(currentRoom)
            .collection('messages')
            .orderBy('timestamp', 'asc')
            .onSnapshot((snapshot) => {
                snapshot.docChanges().forEach((change) => {
                    if (change.type === 'added') {
                        const message = change.doc.data();
                        displayMessage(message);
                    }
                });
            });
    }

    // Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
    function displayMessage(message) {
        const chatContainer = document.getElementById('chatContainer');
        
        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${message.type || 'other'}`;
        
        const time = new Date(message.timestamp?.toDate() || Date.now());
        const timeString = time.toLocaleTimeString('ar-SA', { 
            hour: '2-digit', 
            minute: '2-digit' 
        });
        
        messageDiv.innerHTML = `
            <div class="message-header">
                <img src="${message.avatar}" class="message-avatar" alt="${message.senderName}">
                <span class="message-username">${message.senderName}</span>
            </div>
            <div class="message-content">${message.text}</div>
            <div class="message-time">${timeString}</div>
        `;
        
        chatContainer.appendChild(messageDiv);
        chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ù†Ø¸Ø§Ù…
    function addSystemMessage(text) {
        const message = {
            type: 'system',
            senderName: 'Ø§Ù„Ù†Ø¸Ø§Ù…',
            text: text,
            timestamp: new Date()
        };
        
        displayMessage(message);
        
        // Ø­ÙØ¸ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        db.collection('rooms').doc(currentRoom)
            .collection('messages')
            .add(message);
    }

    // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø´Ø§Øª
    function handleChatInput(event) {
        if (event.key === 'Enter') {
            const input = document.getElementById('chatInput');
            const text = input.value.trim();
            
            if (text) {
                sendMessage(text);
                input.value = '';
            }
        }
    }

    // Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø©
    function sendMessage(text) {
        if (!currentUserData || !currentRoom) return;
        
        const message = {
            type: 'user',
            senderId: currentUser.uid,
            senderName: currentUserData.displayName,
            avatar: currentUserData.photoURL,
            text: text,
            timestamp: new Date()
        };
        
        // Ø­ÙØ¸ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        db.collection('rooms').doc(currentRoom)
            .collection('messages')
            .add(message);
    }

    // ØªØ¨Ø¯ÙŠÙ„ Ø­Ø§Ù„Ø© Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†
    function toggleMic() {
        if (!localStream) return;
        
        const audioTrack = localStream.getAudioTracks()[0];
        if (audioTrack) {
            isMuted = !audioTrack.enabled;
            audioTrack.enabled = !isMuted;
            
            updateMicButton();
            
            // ØªØ­Ø¯ÙŠØ« ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            if (currentRoom) {
                db.collection('rooms').doc(currentRoom).get().then(doc => {
                    if (doc.exists) {
                        const roomData = doc.data();
                        const updatedUsers = roomData.users.map(user => {
                            if (user.uid === currentUser.uid) {
                                return { ...user, isMuted: isMuted };
                            }
                            return user;
                        });
                        
                        db.collection('rooms').doc(currentRoom).update({
                            users: updatedUsers
                        });
                    }
                });
            }
        }
    }

    // ØªØ­Ø¯ÙŠØ« Ø²Ø± Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†
    function updateMicButton() {
        const micBtn = document.getElementById('micBtn');
        if (micBtn) {
            if (isMuted) {
                micBtn.innerHTML = '<i class="fas fa-microphone-slash"></i>';
                micBtn.style.background = '#ef4444';
            } else {
                micBtn.innerHTML = '<i class="fas fa-microphone"></i>';
                micBtn.style.background = '#22c55e';
            }
        }
    }

    // ÙƒØªÙ… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
    function toggleMuteAll() {
        showNotification('ØªÙ… ÙƒØªÙ… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†', 'info');
    }

    // Ø¯Ø¹ÙˆØ© Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡
    function inviteFriends() {
        const inviteLink = `${window.location.origin}/afnan.html?join=${currentRoom}`;
        navigator.clipboard.writeText(inviteLink).then(() => {
            showNotification('ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯Ø¹ÙˆØ©', 'success');
        });
    }

    // ÙØªØ­ Ø§Ù„Ù‡Ø¯Ø§ÙŠØ§
    function openGifts() {
        showNotification('Ù‚Ø±ÙŠØ¨Ø§Ù‹: Ù…ØªØ¬Ø± Ø§Ù„Ù‡Ø¯Ø§ÙŠØ§', 'info');
    }

    // ÙØªØ­ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
    function openSettings() {
        showNotification('Ù‚Ø±ÙŠØ¨Ø§Ù‹: Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙˆØª', 'info');
    }

    // Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø±ÙˆÙ…
    function showRoomInfo() {
        if (!roomData) return;
        
        const info = `
Ø§Ø³Ù… Ø§Ù„Ø±ÙˆÙ…: ${roomData.name}
Ø§Ù„Ù…Ø§Ù„Ùƒ: ${roomData.ownerName}
Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡: ${roomData.users?.length || 0}
Ø§Ù„Ø³Ø¹Ø©: ${roomData.maxUsers}
ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡: ${new Date(roomData.createdAt?.toDate()).toLocaleDateString('ar-SA')}
        `;
        
        alert(info);
    }

    // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø´Ø§Øª
    function toggleChat() {
        const chatContainer = document.getElementById('chatContainer');
        const inputContainer = document.querySelector('.input-container');
        
        isChatVisible = !isChatVisible;
        
        if (isChatVisible) {
            chatContainer.style.display = 'flex';
            inputContainer.style.display = 'block';
        } else {
            chatContainer.style.display = 'none';
            inputContainer.style.display = 'none';
        }
    }

    // ØªØ¨Ø¯ÙŠÙ„ ÙˆØ¶Ø¹ Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©
    function toggleFullscreen() {
        if (!document.fullscreenElement) {
            document.documentElement.requestFullscreen().catch(console.error);
        } else {
            document.exitFullscreen();
        }
    }

    // ÙØªØ­ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙˆØª
    function openAudioSettings() {
        // ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­Ø§Øª Ø§Ù„Ø­Ø¯ÙŠØ«Ø© ÙŠÙ…ÙƒÙ† ÙØªØ­ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¬Ù‡Ø§Ø²
        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
            navigator.mediaDevices.getUserMedia({ audio: true })
                .then(stream => {
                    // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© ÙˆØ§Ø¬Ù‡Ø© Ù„Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙˆØª
                    showNotification('Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙˆØª Ù…ØªØ§Ø­Ø©', 'info');
                })
                .catch(console.error);
        }
    }

    // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ (Ù„Ù„Ù…Ø³ØªÙ‚Ø¨Ù„)
    function toggleCamera() {
        showNotification('Ù…ÙŠØ²Ø© Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ù‚Ø±ÙŠØ¨Ø§Ù‹', 'info');
    }

    // Ù…ØºØ§Ø¯Ø±Ø© Ø§Ù„Ø±ÙˆÙ…
    async function leaveRoom() {
        if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…ØºØ§Ø¯Ø±Ø© Ø§Ù„Ø±ÙˆÙ…ØŸ')) {
            try {
                // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø§Ø±Ø© Ù…ØºØ§Ø¯Ø±Ø©
                sendSignal('leave', null);
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±ÙˆÙ…
                if (currentRoom) {
                    const roomDoc = await db.collection('rooms').doc(currentRoom).get();
                    if (roomDoc.exists) {
                        const roomData = roomDoc.data();
                        const updatedUsers = roomData.users?.filter(u => u.uid !== currentUser.uid) || [];
                        
                        if (updatedUsers.length === 0) {
                            // Ø­Ø°Ù Ø§Ù„Ø±ÙˆÙ… Ø¥Ø°Ø§ Ø£ØµØ¨Ø­ ÙØ§Ø±ØºØ§Ù‹
                            await db.collection('rooms').doc(currentRoom).delete();
                            await rtdb.ref(`rooms/${currentRoom}`).remove();
                        } else {
                            await db.collection('rooms').doc(currentRoom).update({
                                users: updatedUsers,
                                currentSpeakers: Math.max(updatedUsers.filter(u => u.isSpeaker).length, 1)
                            });
                        }
                    }
                }
                
                // ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                await db.collection('users').doc(currentUser.uid).update({
                    currentRoom: null
                });
                
                // Ø¥ØºÙ„Ø§Ù‚ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§ØªØµØ§Ù„Ø§Øª
                Object.values(peerConnections).forEach(pc => pc.close());
                peerConnections = {};
                
                if (localStream) {
                    localStream.getTracks().forEach(track => track.stop());
                    localStream = null;
                }
                
                // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªÙ…Ø¹ÙŠÙ†
                if (messagesListener) messagesListener();
                if (roomListener) roomListener();
                if (signalsListener) signalsListener();
                
                // Ø¥Ø²Ø§Ù„Ø© Ø¹Ù†Ø§ØµØ± Ø§Ù„ØµÙˆØª
                document.querySelectorAll('audio[id^="audio-"]').forEach(audio => audio.remove());
                
                // Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                window.location.href = 'afnan.html';
                
            } catch (error) {
                console.error('Error leaving room:', error);
                showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ù…ØºØ§Ø¯Ø±Ø© Ø§Ù„Ø±ÙˆÙ…', 'error');
            }
        }
    }

    // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
    function showNotification(message, type = 'info') {
        const notification = document.createElement('div');
        notification.className = 'notification';
        
        let icon = 'info-circle';
        if (type === 'success') icon = 'check-circle';
        if (type === 'error') icon = 'exclamation-circle';
        if (type === 'warning') icon = 'exclamation-triangle';
        
        notification.innerHTML = `
            <i class="fas fa-${icon}"></i>
            <span>${message}</span>
        `;
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.remove();
        }, 3000);
    }

    // Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØµÙØ­Ø©
    window.addEventListener('beforeunload', async (e) => {
        if (currentRoom) {
            e.preventDefault();
            e.returnValue = 'Ø£Ù†Øª ÙÙŠ Ø±ÙˆÙ… ØµÙˆØªÙŠ Ø­Ø§Ù„ÙŠØ§Ù‹. Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ù…ØºØ§Ø¯Ø±Ø©ØŸ';
            
            // Ù…Ø­Ø§ÙˆÙ„Ø© Ù…ØºØ§Ø¯Ø±Ø© Ø§Ù„Ø±ÙˆÙ… Ù‚Ø¨Ù„ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚
            await leaveRoom();
        }
    });

    // Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª
    window.addEventListener('online', () => {
        showNotification('ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª', 'success');
    });
    
    window.addEventListener('offline', () => {
        showNotification('ÙÙ‚Ø¯Ø§Ù† Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª', 'error');
    });
</script>

</body>
</html>
