<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Afnan AI - تسجيل الدخول</title>
    
    <!-- Fonts: Noto Sans Arabic -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@300;400;600;800&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            font-family: 'Noto Sans Arabic', sans-serif;
            touch-action: manipulation;
        }

        body {
            background: radial-gradient(circle at 0% 0%, #eef2ff 0%, #fdf2f8 50%, #f0f9ff 100%);
            color: #1f2937;
            overflow-x: hidden;
            min-height: 100vh;
        }

        .glass {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: 
                0 10px 30px -5px rgba(0, 0, 0, 0.1),
                0 4px 10px -2px rgba(0, 0, 0, 0.05),
                inset 0 1px 0 0 rgba(255, 255, 255, 0.8);
        }

        .fade-in { animation: fadeIn 0.6s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px) scale(0.98); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        /* Loading Spinner */
        .loader {
            border: 3px solid #f3f3f3;
            border-radius: 50%;
            border-top: 3px solid #3b82f6;
            width: 24px;
            height: 24px;
            -webkit-animation: spin 1s linear infinite; /* Safari */
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .btn-hover {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .btn-hover:active {
            transform: scale(0.96);
        }
        
        /* الصورة الخلفية */
        .background-image {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: url('https://i.postimg.cc/15w0JQjz/9479a3.jpg');
            background-size: cover;
            background-position: center;
            opacity: 0.1;
            z-index: 0;
        }
    </style>
</head>
<body class="antialiased flex items-center justify-center min-h-screen relative">

    <!-- Background Elements -->
    <div class="background-image"></div>
    
    <div class="fixed inset-0 overflow-hidden pointer-events-none z-1">
        <div class="absolute -top-[10%] -right-[10%] w-[50%] h-[50%] bg-blue-400/10 rounded-full blur-3xl animate-pulse"></div>
        <div class="absolute top-[40%] -left-[10%] w-[40%] h-[40%] bg-purple-400/10 rounded-full blur-3xl"></div>
        <div class="absolute -bottom-[10%] right-[20%] w-[40%] h-[40%] bg-indigo-400/10 rounded-full blur-3xl"></div>
    </div>

    <!-- ================= AUTH SCREEN ================= -->
    <div class="w-full max-w-sm p-6 relative z-10 fade-in">
        <div class="glass p-8 rounded-[40px] text-center w-full relative overflow-hidden group">
            
            <!-- Logo Area -->
            <div class="relative z-10 mb-8">
                <div class="w-24 h-24 bg-white rounded-3xl mx-auto mb-6 flex items-center justify-center shadow-[0_8px_30px_rgb(0,0,0,0.04)] border border-white/50 group-hover:scale-105 transition-transform duration-500">
                    <div class="relative w-12 h-12">
                         <!-- Abstract AI Logo using CSS -->
                         <div class="absolute inset-0 bg-gradient-to-tr from-blue-600 to-purple-600 rounded-xl rotate-3 opacity-90"></div>
                         <div class="absolute inset-0 bg-gradient-to-bl from-blue-500 to-indigo-500 rounded-xl -rotate-3 opacity-90 flex items-center justify-center text-white">
                             <i data-lucide="sparkles" class="w-6 h-6"></i>
                         </div>
                    </div>
                </div>
                <h1 class="text-3xl font-black mb-2 text-gray-800 tracking-tight">Afnan AI</h1>
                <p class="text-gray-500 font-medium text-sm leading-relaxed">بوابتك الذكية للمستقبل.<br>سجل الدخول للمتابعة.</p>
            </div>
            
            <!-- Buttons Area -->
            <div class="space-y-4 relative z-10">
                <!-- Twitter Button -->
                <button id="twitterBtn" onclick="handleLogin('twitter')" class="btn-hover w-full py-4 rounded-2xl bg-black text-white font-bold text-lg shadow-xl shadow-black/5 flex items-center justify-center gap-3 group/btn hover:bg-gray-900 relative overflow-hidden">
                    <div class="absolute inset-0 bg-white/10 translate-y-full group-hover/btn:translate-y-0 transition-transform duration-300"></div>
                    <svg class="w-5 h-5 relative z-10" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.213c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/>
                    </svg>
                    <span class="relative z-10">المتابعة عبر X</span>
                </button>

                <!-- Google Button -->
                <button id="googleBtn" onclick="handleLogin('google')" class="btn-hover w-full py-4 rounded-2xl bg-white border border-gray-100 text-gray-700 font-bold text-lg shadow-[0_4px_20px_rgb(0,0,0,0.03)] hover:bg-gray-50 flex items-center justify-center gap-3">
                    <svg class="w-5 h-5" viewBox="0 0 24 24">
                        <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                        <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                        <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l3.66-2.84z"/>
                        <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                    </svg>
                    <span>المتابعة عبر Google</span>
                </button>
            </div>

            <!-- Loading Overlay -->
            <div id="loadingOverlay" class="absolute inset-0 bg-white/80 backdrop-blur-sm z-50 flex flex-col items-center justify-center hidden rounded-[40px]">
                <div class="loader mb-4"></div>
                <p class="text-sm font-semibold text-gray-600 animate-pulse">جاري التحويل الآمن...</p>
            </div>
            
            <div class="mt-8 text-xs text-gray-400">
                باستخدامك للمنصة أنت توافق على <a href="#" class="underline hover:text-blue-500">الشروط والأحكام</a>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { 
            getAuth, 
            TwitterAuthProvider, 
            GoogleAuthProvider, 
            signInWithPopup,
            onAuthStateChanged
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { 
            getFirestore,
            doc,
            getDoc,
            setDoc
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBnmqWRY6lV54meFvO89QeXwtd28w81FcY",
            authDomain: "rtx3090-28439.firebaseapp.com",
            projectId: "rtx3090-28439",
            storageBucket: "rtx3090-28439.firebasestorage.app",
            messagingSenderId: "178612030690",
            appId: "1:178612030690:web:883189ced2ed3a78e3e2bb",
            databaseURL: "https://rtx3090-28439-default-rtdb.firebaseio.com/"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        // إعداد اللغة للعربية في واجهة فايربيس
        auth.languageCode = 'ar';

        const twitterProvider = new TwitterAuthProvider();
        const googleProvider = new GoogleAuthProvider();

        const loadingOverlay = document.getElementById('loadingOverlay');

        function showLoading() {
            loadingOverlay.classList.remove('hidden');
        }

        function hideLoading() {
            loadingOverlay.classList.add('hidden');
        }

        // دالة موحدة للتعامل مع تسجيل الدخول
        window.handleLogin = async (providerName) => {
            showLoading();
            const provider = providerName === 'twitter' ? twitterProvider : googleProvider;
            
            try {
                // استخدام signInWithPopup بدلاً من Redirect
                const result = await signInWithPopup(auth, provider);
                const user = result.user;
                
                // التحقق مما إذا كان المستخدم موجوداً في قاعدة البيانات
                const userDoc = await getDoc(doc(db, "users", user.uid));
                
                if (!userDoc.exists()) {
                    // إنشاء مستخدم جديد
                    await setDoc(doc(db, "users", user.uid), {
                        displayName: user.displayName || "مستخدم جديد",
                        photoURL: user.photoURL || "https://via.placeholder.com/150",
                        email: user.email || "",
                        uid: user.uid,
                        balance: 1000,
                        diamonds: 0,
                        magicLevel: 1,
                        wealthLevel: 1,
                        magicExp: 0,
                        wealthExp: 0,
                        customId: Math.floor(100000 + Math.random() * 900000).toString(),
                        purchasedFrames: [],
                        purchasedBadges: [],
                        purchasedEntrances: [],
                        activeFrame: null,
                        activeBadges: [],
                        activeEntrance: null,
                        friends: [],
                        friendRequests: [],
                        sentRequests: [],
                        blockedUsers: [],
                        receivedGifts: [],
                        dailyGiftClaimed: false,
                        followers: [],
                        fans: [],
                        createdAt: new Date()
                    });
                }
                
                // الانتقال إلى الصفحة الرئيسية بعد تسجيل الدخول
                window.location.href = 'afnan.html';
                
            } catch (error) {
                console.error('خطأ في عملية الدخول:', error);
                hideLoading();
                
                // رسائل خطأ مخصصة
                if (error.code === 'auth/popup-closed-by-user') {
                    alert('تم إغلاق نافذة الدخول. يرجى المحاولة مرة أخرى.');
                } else if (error.code === 'auth/cancelled-popup-request') {
                    alert('تم إلغاء عملية الدخول. يرجى المحاولة مرة أخرى.');
                } else if (error.code === 'auth/popup-blocked') {
                    alert('تم حظر النافذة المنبثقة. يرجى السماح بالنوافذ المنبثقة لهذا الموقع.');
                } else if (error.code === 'auth/account-exists-with-different-credential') {
                    alert('هذا البريد الإلكتروني مرتبط بحساب آخر. يرجى استخدام طريقة تسجيل دخول أخرى.');
                } else {
                    alert(`عذراً، حدث خطأ: ${error.message}`);
                }
            }
        };

        // التحقق من حالة المستخدم
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // إذا كان المستخدم مسجل دخول بالفعل، انتقل مباشرة إلى afnan.html
                console.log("المستخدم مسجل دخول بالفعل، جاري التوجيه...");
                window.location.href = 'afnan.html';
            }
        });

        // تهيئة الأيقونات
        lucide.createIcons();
    </script>
</body>
</html>
